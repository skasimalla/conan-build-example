name: Push Build to Artifactory
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
   
    steps:
      # This action checks out the code from the repository
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Install Conan
        uses: turtlebrowser/get-conan@main

      # This action sets up the JFrog CLI with the Artifactory URL and access token     
      - name: Install and config JF CLI
        uses: jfrog/setup-jfrog-cli@v3
        env:
          JF_URL: ${{ secrets.ARTIFACTORY_URL }}
          JF_ACCESS_TOKEN: ${{ secrets.ARTIFACTORY_ACCESS_TOKEN }}

      # This command adds a new server configuration to the JFrog CLI   
      - run: |
          export SERVER_ID="test"
          jf c add $SERVER_ID --url=$URL --access-token=$ACCESS_TOKEN --interactive=false

      - run: |
          jf rt ping

          rm -rf build
          mkdir -p build
          cd build
          #conan install .. -s build_type=Release --build=missing
          #-r {{repo_name}} 
          
          cp ../src/* . 
          cp ../conanfile.txt .
          cp ../CMakeLists.txt .
          ls -lrt

          conan profile detect
          conan install . -s build_type=Debug --build=missing
          cmake ./CMakeLists.txt -G "Visual Studio 16 2019" -A "x64"
          cmake .
          cmake --build . --config Release
          
          ./bin/Example 
          
          conan remote add test-conan-local-dev  $url
          conan user -p $password -r test-conan-local-dev sam
          conan upload bin/Example -r test-conan-local-dev --all


          
          #jf npmc --repo-deploy=lego-npm-virt --repo-resolve=lego-npm-remote
          #jf npm install --build-name=lego-npm-build --build-number=1.0.${{github.run_number}}
          #jf rt build-add-git lego-npm-build 1.0.${{github.run_number}}
          #jf rt build-collect-env lego-npm-build 1.0.${{github.run_number}}
          #jf rt npm-publish --build-name=lego-npm-build --build-number=1.0.${{github.run_number}}
          #jf rt build-publish lego-npm-build 1.0.${{github.run_number}}
          #jf rt build-scan lego-npm-build 1.0.${{github.run_number}}
          #jf rt build-promote lego-npm-build 1.0.${{github.run_number}} lego-npm-prod-local --status=production

